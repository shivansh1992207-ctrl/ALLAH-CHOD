<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ANURAG MISHRA ‚Äî Panel</title>
  <style>
    body { 
      font-family: system-ui, -apple-system, Roboto, 'Segoe UI', Arial; 
      background: url("https://files.catbox.moe/k6xita.jpg") no-repeat center center fixed;
      background-size: cover;
      color: #e6eef8; 
      padding: 20px; 
    }
    .overlay {
      background: rgba(11,18,32,0.85);
      min-height: 100vh;
      padding: 20px;
      border-radius: 16px;
    }
    .card {
      background: rgba(11,18,32,0.85); 
      padding: 20px; 
      border-radius: 12px; 
      box-shadow: 0 6px 25px rgba(2,6,23,.7); 
      max-width: 950px; 
      margin: 12px auto; 
      border: 2px solid #06b6d4;
    }
    h2 {
      text-align: center; 
      color: #06b6d4; 
      margin-bottom: 12px;
    }
    h2 span { color: #f472b6; }
    textarea,input {
      width: 100%; 
      padding: 10px; 
      border-radius: 8px; 
      border: 1px solid #122235; 
      background: #061226; 
      color: #cfe6ff; 
      font-family: monospace;
      margin-top: 6px;
    }
    button {
      padding: 10px 16px; 
      border-radius: 8px; 
      border: none; 
      cursor: pointer; 
      background: #06b6d4; 
      color: #002024; 
      font-weight: bold;
      flex: 1;
      transition: 0.2s;
    }
    button:hover { background: #0284c7; color: #fff; }
    pre {
      background:#021223; 
      padding:12px; 
      border-radius:8px; 
      height: 320px; 
      overflow:auto; 
      margin-top:10px; 
      font-family: monospace;
    }
    .row { display:flex; gap:8px; margin-top:8px; }
    label { font-weight: bold; margin-top:6px; display:block; }
    .decor { text-align:center; margin-bottom:14px; font-size:20px; color:#f472b6; }
    .footer {
      margin-top: 14px;
      text-align: center;
      font-size: 14px;
      color: #f472b6;
    }
    .stats {
      margin-top: 10px;
      font-size: 14px;
      color: #06b6d4;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="overlay">
    <div class="card">
      <h2>ANURAG MISHRA <span>üëÖ</span>PANNEL</h2>
      <div class="decor">‚ú® Welcome to your Love Bot ‚ú®</div>
      <p>Paste your <strong>AppState JSON</strong> and <strong>Admin UID</strong>, then start your bot.</p>

      <label>Admin UID</label>
      <input id="admin" placeholder="61578840237242" />

      <label>AppState (JSON)</label>
      <textarea id="appstate" rows="10" placeholder='Paste appstate JSON here'></textarea>

      <div class="row">
        <button id="start">Start Bot</button>
        <button id="stop">Stop Bot</button>
        <button id="fetchLogs">Fetch Logs</button>
      </div>

      <h3 style="margin-top:12px">Live Logs</h3>
      <pre id="logs">(logs will appear here)</pre>

      <div class="stats">
        ‚è± Bot Running Since: <span id="uptime">0s</span><br/>
        üîÅ Bot Used: <span id="usage">0</span> times
      </div>

      <div class="footer">
        üìû Contact on WhatsApp: <strong>6394812128</strong>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const startBtn = document.getElementById('start');
    const stopBtn = document.getElementById('stop');
    const fetchBtn = document.getElementById('fetchLogs');
    const adminInput = document.getElementById('admin');
    const appstateInput = document.getElementById('appstate');
    const logsPre = document.getElementById('logs');
    const uptimeSpan = document.getElementById('uptime');
    const usageSpan = document.getElementById('usage');

    const socket = io();
    let currentUID = null;
    let startTime = null;
    let usageCount = 0;

    socket.on('connect', () => { console.log('Socket connected'); });

    socket.on('botlog', (msg) => {
      logsPre.textContent += msg + "\n";
      logsPre.scrollTop = logsPre.scrollHeight;
    });

    startBtn.onclick = async () => {
      const admin = adminInput.value.trim();
      const appstate = appstateInput.value.trim();
      if (!admin || !appstate) return alert('Admin UID and AppState are required');

      try {
        const res = await fetch('/start-bot', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ admin, appstate })
        });
        const text = await res.text();
        alert(text);
        currentUID = admin;
        socket.emit('join', admin);
        logsPre.textContent = '';
        fetchLogs();

        // uptime + usage
        startTime = Date.now();
        usageCount++;
        usageSpan.textContent = usageCount;
      } catch (e) { alert('Start failed: ' + e); }
    };

    stopBtn.onclick = async () => {
      const admin = adminInput.value.trim();
      if (!admin) return alert('Admin UID required');
      const res = await fetch('/stop-bot?uid=' + encodeURIComponent(admin));
      const text = await res.text();
      alert(text);
    };

    fetchBtn.onclick = fetchLogs;

    async function fetchLogs() {
      const uid = adminInput.value.trim();
      if (!uid) return alert('Enter UID to fetch logs');
      const res = await fetch('/logs?uid=' + encodeURIComponent(uid));
      const text = await res.text();
      logsPre.textContent = text;
      logsPre.scrollTop = logsPre.scrollHeight;
    }

    // uptime timer
    setInterval(() => {
      if (startTime) {
        const diff = Math.floor((Date.now() - startTime)/1000);
        let hrs = Math.floor(diff/3600);
        let mins = Math.floor((diff%3600)/60);
        let secs = diff%60;
        uptimeSpan.textContent = `${hrs}h ${mins}m ${secs}s`;
      }
    },1000);
  </script>
</body>
</html>
