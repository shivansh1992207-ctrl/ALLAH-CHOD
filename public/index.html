<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ANURAG MISHRA ‚Äî Panel</title>
  <style>
    body { 
      font-family: system-ui, -apple-system, Roboto, 'Segoe UI', Arial; 
      background: url("https://files.catbox.moe/k6xita.jpg") no-repeat center center fixed;
      background-size: cover;
      color: #e6eef8; 
      padding: 20px; 
    }
    .overlay {
      min-height: 100vh;
      padding: 20px;
    }
    .card {
      background: transparent;
      padding: 20px; 
      border-radius: 16px; 
      max-width: 950px; 
      margin: 20px auto; 
      border: 2px solid rgba(6,182,212,0.8);
      box-shadow: 0 0 20px rgba(6,182,212,0.8);
    }
    h2 {
      text-align: center; 
      color: #06b6d4; 
      margin-bottom: 12px;
      font-size: 28px;
      text-shadow: 0 0 12px rgba(6,182,212,1);
    }
    h2 span { 
      color: #f472b6; 
      text-shadow: 0 0 12px rgba(244,114,182,1); 
    }
    textarea,input {
      width: 100%; 
      padding: 10px; 
      border-radius: 10px; 
      border: 1px solid rgba(6,182,212,0.7); 
      background: transparent;
      color: #fff; 
      font-family: monospace;
      margin-top: 6px;
      box-shadow: 0 0 10px rgba(6,182,212,0.6);
    }
    button {
      padding: 12px 18px; 
      border-radius: 10px; 
      border: 1px solid rgba(6,182,212,0.9);
      cursor: pointer; 
      background: transparent;
      color: #fff; 
      font-weight: bold;
      flex: 1;
      transition: 0.25s;
      box-shadow: 0 0 15px rgba(6,182,212,0.8);
      text-shadow: 0 0 8px rgba(6,182,212,1);
    }
    button:hover { 
      background: rgba(244,114,182,0.15);
      border-color: rgba(244,114,182,1);
      box-shadow: 0 0 18px rgba(244,114,182,1);
      transform: scale(1.05);
    }
    pre {
      background: rgba(0,0,0,0.3); /* thoda visible background */
      padding:12px; 
      border-radius:10px; 
      height: 320px; 
      overflow:auto; 
      margin-top:10px; 
      font-family: monospace;
      border: 1px solid rgba(6,182,212,0.7);
      box-shadow: 0 0 15px rgba(6,182,212,0.8);
      color: #dbeafe;
      white-space: pre-wrap;       /* wrap long lines */
      word-break: break-word;      /* avoid invisible overflow */
    }
    .row { display:flex; gap:10px; margin-top:8px; }
    label { 
      font-weight: bold; 
      margin-top:6px; 
      display:block; 
      text-shadow: 0 0 8px rgba(6,182,212,0.8);
    }
    .decor { 
      text-align:center; 
      margin-bottom:14px; 
      font-size:20px; 
      color:#f472b6; 
      text-shadow:0 0 12px rgba(244,114,182,1);
    }
    .footer {
      margin-top: 20px;
      text-align: center;
    }
    .whatsapp-btn {
      display:inline-block;
      padding:12px 22px;
      border-radius:12px;
      background:linear-gradient(135deg,#06b6d4,#0284c7);
      color:#fff;
      font-weight:bold;
      text-decoration:none;
      box-shadow:0 0 15px rgba(6,182,212,0.9);
      text-shadow:0 0 8px rgba(6,182,212,1);
      transition:0.25s;
    }
    .whatsapp-btn:hover {
      background:linear-gradient(135deg,#f472b6,#db2777);
      box-shadow:0 0 18px rgba(244,114,182,1);
      transform: scale(1.07);
    }
    .stats {
      margin-top: 10px;
      font-size: 14px;
      color: #06b6d4;
      text-align: center;
      text-shadow:0 0 10px rgba(6,182,212,1);
    }
  </style>
</head>
<body>
  <div class="overlay">
    <div class="card">
      <h2>ANURAG MISHRA<span>‚ù§Ô∏è‚Äçüî•</span>PANEL</h2>
      <div class="decor">‚ú® Welcome to your Love Bot ‚ú®</div>
      <p>Paste your <strong>AppState JSON</strong> and <strong>Admin UID</strong>, then start your bot.</p>

      <label>Admin UID</label>
      <input id="admin" placeholder="61578840237242" />

      <label>AppState (JSON)</label>
      <textarea id="appstate" rows="10" placeholder='Paste appstate JSON here'></textarea>

      <div class="row">
        <button id="start">Start Bot</button>
        <button id="stop">Stop Bot</button>
        <button id="fetchLogs">Fetch Logs</button>
      </div>

      <h3 style="margin-top:12px;text-shadow:0 0 10px rgba(6,182,212,1)">Live Logs</h3>
      <pre id="logs">(logs will appear here)</pre>

      <div class="stats">
        ‚è± Bot Running Since: <span id="uptime">0s</span><br/>
        üîÅ Bot Used: <span id="usage">0</span> times
      </div>

      <div class="footer">
        <a href="https://wa.me/916394812128" target="_blank" class="whatsapp-btn">üìû Contact on WhatsApp</a>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const startBtn = document.getElementById('start');
    const stopBtn = document.getElementById('stop');
    const fetchBtn = document.getElementById('fetchLogs');
    const adminInput = document.getElementById('admin');
    const appstateInput = document.getElementById('appstate');
    const logsPre = document.getElementById('logs');
    const uptimeSpan = document.getElementById('uptime');
    const usageSpan = document.getElementById('usage');

    const socket = io();
    let startTime = null;
    let usageCount = 0;

    // Join socket room for this admin UID
    adminInput.addEventListener('input', () => {
      const uid = adminInput.value.trim();
      if(uid) socket.emit('join', uid);
    });

    socket.on('botlog', (msg) => {
      logsPre.textContent += msg + "\n";
      logsPre.scrollTop = logsPre.scrollHeight;
    });

    startBtn.onclick = async () => {
      const admin = adminInput.value.trim();
      const appstate = appstateInput.value.trim();
      if (!admin || !appstate) return alert('Admin UID and AppState are required');

      const res = await fetch('/start-bot', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ admin, appstate })
      });
      alert(await res.text());
      logsPre.textContent = '';

      startTime = Date.now();
      usageCount++;
      usageSpan.textContent = usageCount;

      // join socket room again after start
      socket.emit('join', admin);
    };

    stopBtn.onclick = async () => {
      const admin = adminInput.value.trim();
      if (!admin) return alert('Admin UID required');
      const res = await fetch('/stop-bot?uid=' + encodeURIComponent(admin));
      alert(await res.text());
    };

    fetchBtn.onclick = async () => {
      const uid = adminInput.value.trim();
      if (!uid) return alert('Enter UID to fetch logs');
      const res = await fetch('/logs?uid=' + encodeURIComponent(uid));
      logsPre.textContent = await res.text();
      logsPre.scrollTop = logsPre.scrollHeight;
    };

    setInterval(() => {
      if (startTime) {
        const diff = Math.floor((Date.now() - startTime)/1000);
        let hrs = Math.floor(diff/3600);
        let mins = Math.floor((diff%3600)/60);
        let secs = diff%60;
        uptimeSpan.textContent = `${hrs}h ${mins}m ${secs}s`;
      }
    },1000);
  </script>
</body>
</html>
